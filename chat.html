<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Career Assistant | VidyaGyan</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #5687f1;
            --primary-dark: #1d4ed8;
            --accent-color: #3b82f6;
            --text-color: #1f2937;
            --light-text: #ffffff;
            --light-bg: #93b7eb;
            --border-radius: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --navbar-bg: #1e293b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Custom CSS for the Chatbot Button */
        #chatbot-button {
            position: fixed;
            bottom: 50px;
            right: 50px;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #6366f1;
        }

        #chatbot-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        #chatbot-button img {
            width: 90%;
            height: 90%;
            object-fit: contain;
            border-radius: 50%;
        }

        /* Chat Styles */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 1000px;
            margin: 30px auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            height: calc(100vh - 150px);
        }

        .chat-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h2 {
            font-size: 20px;
            font-weight: 600;
        }

        .chat-header .status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background-color: #10b981;
            border-radius: 50%;
        }

        .chat-window {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            background-color: #f8fafc;
        }

        .message {
            max-width: 75%;
            padding: 12px 16px;
            margin-bottom: 15px;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--primary-color);
            color: var(--light-text);
            border-radius: 18px;
            border-bottom-right-radius: 4px;
        }

        .bot-message {
            align-self: flex-start;
            background-color: white;
            color: var(--text-color);
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #e5e7eb;
            background-color: white;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #d1d5db;
            border-radius: 20px;
            outline: none;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
        }

        .chat-input input:focus {
            border-color: var(--primary-color);
        }

        .chat-input button {
            margin-left: 10px;
            background-color: var(--primary-color);
            color: white;
            padding: 0 20px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Inter', sans-serif;
        }

        .chat-input button:hover {
            background-color: var(--primary-dark);
        }

        .chat-guidance {
            padding: 15px;
            background-color: rgba(37, 99, 235, 0.1);
            border-left: 3px solid var(--primary-color);
            margin-bottom: 15px;
            font-size: 14px;
            border-radius: 0 8px 8px 0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .chat-container {
                margin: 10px;
                height: calc(100vh - 120px);
            }

            .message {
                max-width: 90%;
            }
        }
    </style>
</head>

<body class="bg-gray-100">

    <!-- Header Navigation Bar -->
    <header class="relative z-20 w-full p-2 flex justify-between items-center text-white bg-gray-900">
        <div class="flex items-center space-x-2">
            <!-- Mobile Menu Button -->
            <button id="menu-btn" class="text-white focus:outline-none md:hidden">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 6h16M4 12h16m-7 6h7"></path>
                </svg>
            </button>
            <!-- Logo and Site Name -->
            <div class="flex items-center space-x-2">
                <a href="index.html">
                    <img src="./assets/mainlogo.png" alt="VidyaGyan Logo" class="w-10 h-10">
                </a>
                <span class="text-3xl font-bold text-white">VidyaGyan</span>
            </div>
        </div>
        <!-- Desktop Navigation Links -->
        <nav class="hidden md:flex items-center space-x-4 text-base">
            <a href="career_paths.html"
                class="text-white px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors duration-200">Career Paths</a>
            <a href="roadmaps/roadmap.html"
                class="text-white px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors duration-200">Roadmaps</a>
            <a href="colleges.html"
                class="text-white px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors duration-200">Colleges</a>
            <a href="exams.html"
                class="text-white px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors duration-200">Exams</a>
            <a href="resources.html"
                class="text-white px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors duration-200">Resources</a>
            <a href="study_groups.html"
                class="text-white px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors duration-200">Study Groups</a>
            <a href="scholarship.html"
                class="text-white px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors duration-200">Scholarships</a>
        </nav>
        <!-- Action Buttons (Home, Profile, and For You) -->
        <div class="hidden md:flex items-center space-x-4">
            <a href="home.html"
                class="flex items-center space-x-2 text-white hover:text-gray-200 px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors duration-200">
                <!-- Home Icon -->
                <img src="assets/home.png" alt="Home" class="w-8 h-8">
            </a>
            <a href="profile.html"
                class="flex items-center space-x-2 text-white hover:text-gray-200 px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors duration-200">
                <!-- Profile Icon -->
                <img src="assets/profile.jpg" alt="Profile" class="w-8 h-8">
            </a>
            <a href="foryou.html"
                class="text-sm px-6 py-3 rounded-full border-2 border-blue-500 text-blue-500 hover:text-white hover:bg-blue-500 transition-colors duration-300">For You</a>
        </div>
    </header>

    <!-- Chatbot Button (since we're on chat page, it can link to home or be disabled) -->
    <a href="home.html" id="chatbot-button" title="Go to Home">
        <img src="./assets/images/chat.jpeg" alt="Chatbot" />
    </a>

    <!-- Chat Container -->
    <div class="chat-container">
        <div class="chat-header">
            <h2><i class="fas fa-graduation-cap"></i> Career Guidance Assistant</h2>
            <div class="status">
                <div class="status-dot"></div>
                <span>Online</span>
            </div>
        </div>

        <div class="chat-guidance">
            <p><i class="fas fa-info-circle"></i> Hi there! I'm here to help students who have completed their 10th or 12th grade figure out their next steps. I'll ask about your interests, favorite subjects, strengths, and career dreams to suggest the best paths forward!</p>
        </div>

        <div class="chat-window" id="chat-window">
            <!-- Initial welcome message -->
            <div class="message bot-message">
                Hey there! 🎓 Congratulations on completing your studies! I'm your VidyaGyan career assistant, and I'm here to help you discover amazing career paths that match who you are and what you love doing.

Whether you've just finished 10th or 12th grade, choosing your next step can feel overwhelming - but don't worry, we'll figure it out together!

To get started, could you tell me:
1. Have you completed 10th or 12th grade?
2. What subjects do you enjoy the most or find easiest?
3. What are some things you love doing in your free time?
            </div>
        </div>

        <div class="chat-input">
            <input type="text" id="input" placeholder="Share your thoughts here..." />
            <button onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
                Send
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 p-6 pt-10 mt-16">
        <div class="container mx-auto grid grid-cols-1 md:grid-cols-5 gap-8">
            <!-- Logo Column (spans full height) -->
            <div class="col-span-1 flex justify-center items-center">
                <img src="./assets/mainlogo.png" alt="VidyaGyan Logo" class="w-75 h-60">
            </div>

            <!-- VidyaGyan Info Column -->
            <div class="col-span-1 flex flex-col">
                <h3 class="text-white font-bold text-xl mb-2">VidyaGyan</h3>
                <p class="text-gray-400 text-sm mb-6">Your all-in-one platform for academic and career guidance.</p>
                
                <div class="mb-4">
                    <h4 class="text-white font-semibold text-lg mb-2">Blastorz</h4>
                    <div class="flex space-x-2 items-center mb-2">
                        <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"/>
                        </svg>
                        <a href="mailto:team.blastorz@gmail.com" class="text-gray-400 hover:text-white text-sm transition-colors duration-200">
                            team.blastorz@gmail.com
                        </a>
                    </div>
                    <div class="flex space-x-2 items-center">
                        <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                        <a href="members.html" class="text-gray-400 hover:text-white text-sm transition-colors duration-200">
                            Team Blastorz Info
                        </a>
                    </div>
                </div>
            </div>

            <!-- Navigation Column -->
            <div class="col-span-1">
                <h4 class="text-white font-semibold text-lg mb-4">Navigation</h4>
                <ul class="space-y-3">
                    <li><a href="home.html" class="text-gray-300 hover:text-white transition-colors duration-200">Home</a></li>
                    <li><a href="profile.html" class="text-gray-300 hover:text-white transition-colors duration-200">Profile</a></li>
                    <li><a href="foryou.html" class="text-gray-300 hover:text-white transition-colors duration-200">For You</a></li>
                </ul>
            </div>

            <!-- Resources Column -->
            <div class="col-span-1">
                <h4 class="text-white font-semibold text-lg mb-4">Resources</h4>
                <ul class="space-y-3">
                    <li><a href="colleges.html" class="text-gray-300 hover:text-white transition-colors duration-200">Colleges</a></li>
                    <li><a href="career_paths.html" class="text-gray-300 hover:text-white transition-colors duration-200">Career Paths</a></li>
                    <li><a href="roadmaps/roadmap.html" class="text-gray-300 hover:text-white transition-colors duration-200">Roadmaps</a></li>
                    <li><a href="exams.html" class="text-gray-300 hover:text-white transition-colors duration-200">Entrance Exams</a></li>
                    <li><a href="resources.html" class="text-gray-300 hover:text-white transition-colors duration-200">Study Materials</a></li>
                    <li><a href="scholarship.html" class="text-gray-300 hover:text-white transition-colors duration-200">Scholarships</a></li>
                </ul>
            </div>

            <!-- Community & Account Column -->
            <div class="col-span-1">
                <h4 class="text-white font-semibold text-lg mb-4">Community & Account</h4>
                <ul class="space-y-3">
                    <li><a href="login.html" class="text-gray-300 hover:text-white transition-colors duration-200">Login</a></li>
                    <li><a href="signup.html" class="text-gray-300 hover:text-white transition-colors duration-200">Sign Up</a></li>
                    <li><a href="study_groups.html" class="text-gray-300 hover:text-white transition-colors duration-200">Study Groups</a></li>
                </ul>
            </div>
        </div>

        <!-- Copyright -->
        <div class="border-t border-gray-700 mt-6 pt-3 text-center">
            <p class="text-gray-400 text-sm">
                Copyright © 2025 - Team Blastorz 💥
            </p>
        </div>
    </footer>

    <script>
        const chatWindow = document.getElementById("chat-window");
        const inputBox = document.getElementById("input");

        const apiKey = "AIzaSyA8Z-mwMfYaFN7Jia8g9v1kmzGTg5Pfk1U";
        const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent";

        // System prompt for Gemini (will be included in each request)
        const systemPrompt = `You are VidyaGyanBot, a friendly and encouraging career assistant specifically designed for Indian students who have completed their 10th or 12th grade and are unsure about their next steps.

Your guidelines:
1. Your primary goal is to help students discover career paths and educational options based on their interests, favorite subjects, strengths, and dreams.
2. Always be encouraging, supportive, and understanding - many students feel overwhelmed at this stage.
3. Ask about their grade completion (10th/12th), favorite subjects, hobbies, strengths, and any career dreams they might have.
4. Provide specific, practical advice including:
   - College course suggestions (Engineering, Medical, Commerce, Arts, etc.)
   - Career options that match their profile
   - Entrance exams they should consider
   - Alternative paths like vocational training, skill development
5. Consider the Indian education system - mention streams like Science (PCM/PCB), Commerce, Arts
6. Be aware of popular career paths in India and emerging opportunities
7. Offer actionable next steps and resources for learning more
8. Keep responses conversational, friendly, and age-appropriate for teenagers
9. Use encouraging language and emojis occasionally to keep it engaging
10. If they seem confused or overwhelmed, reassure them that it's normal and they have time to figure things out`;

        // Initialize conversation history for Gemini
        let conversationHistory = [];

        // Track conversation state for students
        let conversationState = {
            askedAboutGrade: true,
            askedAboutSubjects: true,
            askedAboutInterests: true,
            askedAboutStrengths: false,
            askedAboutCareerDreams: false,
            providedSuggestions: false
        };

        // Capture the Enter key in the input field
        inputBox.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        });

        function appendMessage(sender, text) {
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("message", sender === "user" ? "user-message" : "bot-message");
            messageDiv.textContent = text;
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function updateConversationState(botMessage) {
            const lowerCaseMessage = botMessage.toLowerCase();
            
            // Check what the bot asked about in the most recent message
            if (!conversationState.askedAboutStrengths && 
                (lowerCaseMessage.includes("strength") || lowerCaseMessage.includes("good at") || lowerCaseMessage.includes("talent"))) {
                conversationState.askedAboutStrengths = true;
            }
            
            if (!conversationState.askedAboutCareerDreams && 
                (lowerCaseMessage.includes("dream") || lowerCaseMessage.includes("aspiration") || lowerCaseMessage.includes("want to become"))) {
                conversationState.askedAboutCareerDreams = true;
            }
            
            if (!conversationState.providedSuggestions &&
                (lowerCaseMessage.includes("suggest") || lowerCaseMessage.includes("recommend") || 
                 lowerCaseMessage.includes("consider") || lowerCaseMessage.includes("career option") ||
                 lowerCaseMessage.includes("stream") || lowerCaseMessage.includes("course"))) {
                conversationState.providedSuggestions = true;
            }
        }

        async function sendMessage() {
            const userInput = inputBox.value.trim();
            if (!userInput) {
                return;
            }

            appendMessage("user", userInput);
            inputBox.value = "";

            // Add user message to history
            conversationHistory.push({ role: "user", content: userInput });
            
            // Create and append a temporary "Thinking..." message
            const thinkingDiv = document.createElement("div");
            thinkingDiv.classList.add("message", "bot-message");
            thinkingDiv.textContent = "Thinking... 🤔";
            chatWindow.appendChild(thinkingDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;

            try {
                // Guide the conversation based on what information we still need
                let promptAddition = "";
                if (conversationState.askedAboutGrade && conversationState.askedAboutSubjects && 
                    conversationState.askedAboutInterests && !conversationState.askedAboutStrengths) {
                    promptAddition = "\n\nNow ask them about their strengths - what are they naturally good at or what do others compliment them on?";
                } else if (conversationState.askedAboutStrengths && !conversationState.askedAboutCareerDreams) {
                    promptAddition = "\n\nNow ask if they have any career dreams or if there's something they've always wanted to become.";
                } else if (conversationState.askedAboutCareerDreams && !conversationState.providedSuggestions) {
                    promptAddition = "\n\nBased on all the information they've shared, provide 3-4 specific career suggestions with educational paths (streams/courses) they should consider, along with entrance exams if relevant. Make it encouraging and actionable.";
                }

                // Prepare conversation for Gemini API
                let fullPrompt = systemPrompt + promptAddition + "\n\nConversation History:\n";
                
                // Add conversation history
                conversationHistory.forEach((msg, index) => {
                    if (index === 0) {
                        fullPrompt += `Assistant: Hey there! 🎓 Congratulations on completing your studies! I'm your VidyaGyan career assistant, and I'm here to help you discover amazing career paths that match who you are and what you love doing.

Whether you've just finished 10th or 12th grade, choosing your next step can feel overwhelming - but don't worry, we'll figure it out together!

To get started, could you tell me:
1. Have you completed 10th or 12th grade?
2. What subjects do you enjoy the most or find easiest?
3. What are some things you love doing in your free time?\n\n`;
                    } else {
                        fullPrompt += `${msg.role === "user" ? "Student" : "Assistant"}: ${msg.content}\n\n`;
                    }
                });

                fullPrompt += "Assistant: ";

                const response = await fetch(`${apiUrl}?key=${apiKey}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: fullPrompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 1000,
                        }
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message || "API Error");
                }

                const botReply = data.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I'm having trouble connecting. Please try again! 😅";

                // Update conversation state based on bot reply
                updateConversationState(botReply);
                
                // Add bot response to history
                conversationHistory.push({ role: "assistant", content: botReply });

                // Remove the "Thinking..." message
                thinkingDiv.remove();

                appendMessage("bot", botReply);

            } catch (err) {
                console.error("API error:", err);
                thinkingDiv.remove();
                appendMessage("bot", "I'm having trouble connecting right now. Please try again later! 🔄");
            }
        }

        // Initialize the chat
        console.log("VidyaGyan career guidance chat initialized! 🚀");
    </script>
</body>

</html>